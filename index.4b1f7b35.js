let e,t;class l{constructor(e,t,l){let i=document.createElement("div");i.classList.add("cell"),e.append(i),this.x=t,this.y=l}linkTile(e){e.setXY(this.x,this.y),this.linkedTile=e}unlinkTile(){this.linkedTile=null}isEmpty(){return!this.linkedTile}linkTileForMerge(e){e.setXY(this.x,this.y),this.linkedTileForMerge=e}unlinkTileForMerge(){this.linkedTileForMerge=null}hasTileForMerge(){return!!this.linkedTileForMerge}canAccept(e){return this.isEmpty()||!this.hasTileForMerge()&&this.linkedTile.value===e.value}mergeTiles(){if(2048===this.linkedTile.value){let e=document.querySelector(".message_win");e.classList.remove("hidden"),e.style.color="#00ff00"}else{let e=this.linkedTile.value+this.linkedTileForMerge.value;this.linkedTile.setValue(e),this.linkedTileForMerge.removeFromDOM(),this.unlinkTileForMerge()}}}class i{constructor(e){this.tileElement=document.createElement("div"),this.tileElement.classList.add("tile"),this.setValue(Math.random()>.1?2:4),e.append(this.tileElement)}setXY(e,t){this.x=e,this.y=t,this.tileElement.style.setProperty("--x",e),this.tileElement.style.setProperty("--y",t)}setValue(e){let t=100-9*Math.log2(e);this.value=e,this.tileElement.textContent=e,this.tileElement.style.setProperty("--bg-lightness",`${t}%`),this.tileElement.style.setProperty("--text-lightness",`${t<50?90:10}%`)}removeFromDOM(){this.tileElement.remove()}waitForTransitionEnd(){return new Promise(e=>{this.tileElement.addEventListener("transitionend",e,{once:!0})})}waitForAnimationEnd(){return new Promise(e=>{this.tileElement.addEventListener("animationend",e,{once:!0})})}}const n=document.querySelector(".board"),r=new class{constructor(e){this.cells=[];for(let t=0;t<16;t++)this.cells.push(new l(e,t%4,Math.floor(t/4)));this.cellsGroupedByColumn=this.groupCellsByColumn(),this.cellsGroupedByReservedColumn=this.cellsGroupedByColumn.map(e=>[...e].reverse()),this.cellsGroupedByRow=this.groupCellsByRow(),this.cellsGroupedByReservedRow=this.cellsGroupedByRow.map(e=>[...e].reverse())}getRandomEmptyCell(){let e=this.cells.filter(e=>e.isEmpty()),t=Math.floor(Math.random()*e.length);return e[t]}groupCellsByColumn(){return this.cells.reduce((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e),[])}groupCellsByRow(){return this.cells.reduce((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e),[])}}(n),s=document.querySelector(".start"),o=document.querySelector(".game_score"),a=document.querySelector(".body2048");let c=!1,d=0;function u(){window.addEventListener("keydown",h,{once:!0})}async function h(e){switch(e.key){case"ArrowUp":if(!k()){u();return}await m();break;case"ArrowDown":if(!E()){u();return}await y();break;case"ArrowLeft":if(!T()){u();return}await w();break;case"ArrowRight":if(!g()){u();return}await p();break;default:u();return}let t=new i(n);if(r.getRandomEmptyCell().linkTile(t),!k()&&!E()&&!T()&&!g()){await t.waitForAnimationEnd();let e=document.querySelector(".message_lose");e.classList.remove("hidden"),e.style.color="#ff0000",s.addEventListener("click",()=>{window.location.reload()});return}u()}async function m(){await f(r.cellsGroupedByColumn)}async function y(){await f(r.cellsGroupedByReservedColumn)}async function w(){await f(r.cellsGroupedByRow)}async function p(){await f(r.cellsGroupedByReservedRow)}async function f(e){let t=[];e.forEach(e=>(function(e,t){for(let l=1;l<e.length;l++){let i;if(e[l].isEmpty())continue;let n=e[l],r=l-1;for(;r>=0&&e[r].canAccept(n.linkedTile);)i=e[r],r--;i&&(t.push(n.linkedTile.waitForTransitionEnd()),i.isEmpty()?i.linkTile(n.linkedTile):(i.linkTileForMerge(n.linkedTile),d+=n.linkedTile.value),n.unlinkTile(),o.textContent=`${d}`)}})(e,t)),await Promise.all(t),r.cells.forEach(e=>{e.hasTileForMerge()&&e.mergeTiles()})}function k(){return v(r.cellsGroupedByColumn)}function E(){return v(r.cellsGroupedByReservedColumn)}function T(){return v(r.cellsGroupedByRow)}function g(){return v(r.cellsGroupedByReservedRow)}function v(e){return e.some(e=>e.some((t,l)=>!(0===l||t.isEmpty())&&e[l-1].canAccept(t.linkedTile)))}async function R(e,t){if(Math.abs(e)>Math.abs(t)){if(e>0){if(!g()){u();return}await p()}else{if(!T()){u();return}await w()}}else if(t>0){if(!E()){u();return}await y()}else{if(!k()){u();return}await m()}let l=new i(n);if(r.getRandomEmptyCell().linkTile(l),!k()&&!E()&&!T()&&!g()){await l.waitForAnimationEnd();let e=document.querySelector(".message_lose");e.classList.remove("hidden"),e.style.color="#ff0000",s.addEventListener("click",()=>{window.location.reload()});return}u()}s.addEventListener("click",()=>{r.getRandomEmptyCell().linkTile(new i(n)),s.classList.remove("start"),s.classList.add("restart"),s.textContent="Restart",document.querySelector(".message_start").classList.add("hidden"),c&&window.location.reload(),c=!0}),u(),document.addEventListener("keydown",e=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&e.preventDefault()}),a.addEventListener("touchstart",l=>{e=l.touches[0].clientX,t=l.touches[0].clientY},{passive:!0}),a.addEventListener("touchend",l=>{let i=l.changedTouches[0].clientX,n=l.changedTouches[0].clientY;R(i-e,n-t)},{passive:!0});
//# sourceMappingURL=index.4b1f7b35.js.map
